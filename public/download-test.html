<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ–éŸ³ä¸‹è½½åŠŸèƒ½è°ƒè¯•æ§åˆ¶å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            height: calc(100vh - 140px); /* å›ºå®šä¸»å†…å®¹åŒºåŸŸé«˜åº¦ */
            max-height: 800px;
        }
        
        .test-panel {
            padding: 30px;
            border-right: 1px solid #eee;
            overflow-y: auto; /* å¦‚æœæµ‹è¯•é¢æ¿å†…å®¹è¿‡å¤šä¹Ÿå¯ä»¥æ»šåŠ¨ */
        }
        
        .log-panel {
            padding: 30px;
            background: #f8f9fa;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* é˜²æ­¢æ•´ä¸ªé¢æ¿æº¢å‡º */
        }
        
        .test-section {
            margin-bottom: 25px;
        }
        
        .test-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3rem;
            border-left: 4px solid #ff6b6b;
            padding-left: 15px;
        }
        
        .url-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 1rem;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .url-input:focus {
            outline: none;
            border-color: #ff6b6b;
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .test-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .test-btn.primary {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
        }
        
        .test-btn.secondary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        
        .test-btn.success {
            background: linear-gradient(45deg, #00b894, #00a085);
            color: white;
        }
        
        .test-btn.info {
            background: linear-gradient(45deg, #0984e3, #74b9ff);
            color: white;
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .test-btn:active {
            transform: translateY(0);
        }
        
        .test-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .clear-btn {
            width: 100%;
            background: #ddd;
            color: #666;
        }
        
        .clear-btn:hover {
            background: #ccc;
        }
        
        #log {
            background: #1a1a1a;
            color: #e6e6e6;
            padding: 20px;
            border-radius: 10px;
            flex: 1; /* å ç”¨å‰©ä½™ç©ºé—´ */
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            min-height: 300px; /* æœ€å°é«˜åº¦ */
        }
        
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-shrink: 0; /* ä¸å…è®¸æ”¶ç¼© */
        }
        
        .log-header h3 {
            color: #2c3e50;
            border: none;
            padding: 0;
        }
        
        .log-controls {
            display: flex;
            gap: 10px;
        }
        
        .log-controls button {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            font-size: 0.8rem;
            cursor: pointer;
        }
        
        .success { color: #00b894; }
        .error { color: #e17055; }
        .warning { color: #fdcb6e; }
        .info { color: #74b9ff; }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-indicator.success {
            background: #00b894;
        }
        
        .status-indicator.error {
            background: #e17055;
        }
        
        .status-indicator.warning {
            background: #fdcb6e;
        }
        
        .status-indicator.info {
            background: #74b9ff;
        }
        
        .note {
            background: #f8f9fa;
            border-left: 4px solid #74b9ff;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .note-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .note-content {
            color: #636e72;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                height: calc(100vh - 120px); /* ç§»åŠ¨ç«¯è°ƒæ•´é«˜åº¦ */
            }
            
            .test-panel {
                border-right: none;
                border-bottom: 1px solid #eee;
                max-height: 60vh; /* æµ‹è¯•é¢æ¿æœ€å¤§é«˜åº¦ */
                overflow-y: auto;
            }
            
            .log-panel {
                min-height: 40vh; /* æ—¥å¿—é¢æ¿æœ€å°é«˜åº¦ */
            }
            
            .button-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            #log {
                min-height: 250px; /* ç§»åŠ¨ç«¯æ—¥å¿—åŒºåŸŸæœ€å°é«˜åº¦ */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ æŠ–éŸ³ä¸‹è½½è°ƒè¯•æ§åˆ¶å°</h1>
            <p>æµ‹è¯•å’Œè°ƒè¯•å„ç§ä¸‹è½½åŠŸèƒ½ï¼Œç›‘æ§APIè°ƒç”¨çŠ¶æ€</p>
        </div>
        
        <div class="main-content">
            <div class="test-panel">
                <div class="test-section">
                    <h3>ğŸ”— æµ‹è¯•URLè®¾ç½®</h3>
                    <input 
                        type="text" 
                        id="test-url" 
                        class="url-input" 
                        placeholder="è¾“å…¥æŠ–éŸ³åˆ†äº«é“¾æ¥æˆ–æµ‹è¯•URL..."
                        value="https://v.douyin.com/iMBBgLAf/"
                    >
                    
                    <div class="note">
                        <div class="note-title">ğŸ’¡ æµ‹è¯•æç¤º</div>
                        <div class="note-content">
                            â€¢ å¯ä»¥ä½¿ç”¨çœŸå®çš„æŠ–éŸ³åˆ†äº«é“¾æ¥è¿›è¡Œæµ‹è¯•<br>
                            â€¢ å¦‚æœé“¾æ¥è¿‡æœŸï¼Œå¯ä»¥å°è¯•VideoIDæµ‹è¯•åŠŸèƒ½<br>
                            â€¢ æŸäº›æµ‹è¯•å¯èƒ½éœ€è¦ç½‘ç»œè¿æ¥å’Œæœ‰æ•ˆçš„æŠ–éŸ³é“¾æ¥
                        </div>
                    </div>
                </div>
                
                <div class="test-section">
                    <h3>ğŸ§ª APIåŠŸèƒ½æµ‹è¯•</h3>
                    <div class="button-grid">
                        <button class="test-btn primary" onclick="testZjcdnApi()">
                            ğŸš€ zjcdn API
                        </button>
                        <button class="test-btn secondary" onclick="testGetRealUrl()">
                            ğŸ” URLè§£æ
                        </button>
                        <button class="test-btn success" onclick="testDirectDownload()">
                            â¬‡ï¸ æ™ºèƒ½ä¸‹è½½
                        </button>
                        <button class="test-btn info" onclick="testVideoId()">
                            ğŸ¯ VideoIDæµ‹è¯•
                        </button>
                    </div>
                </div>
                
                <div class="test-section">
                    <h3>ğŸ›  é«˜çº§æµ‹è¯•</h3>
                    <div class="button-grid">
                        <button class="test-btn secondary" onclick="testProxyDownload()">
                            ğŸŒ ä»£ç†ä¸‹è½½
                        </button>
                        <button class="test-btn info" onclick="testVideoProxy()">
                            ï¿½ è§†é¢‘é¢„è§ˆ
                        </button>
                        <button class="test-btn success" onclick="testServerHealth()">
                            â¤ï¸ æœåŠ¡å™¨çŠ¶æ€
                        </button>
                    </div>
                </div>
                
                <div class="test-section">
                    <button class="test-btn clear-btn" onclick="clearLog()">
                        ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—
                    </button>
                </div>
            </div>
            
            <div class="log-panel">
                <div class="log-header">
                    <h3>ğŸ“‹ å®æ—¶æ—¥å¿—</h3>
                    <div class="log-controls">
                        <button onclick="scrollToBottom()">ç½®åº•</button>
                        <button onclick="exportLog()">å¯¼å‡º</button>
                    </div>
                </div>
                <div id="log"></div>
            </div>
        </div>
    </div>

    <script>
        const log = document.getElementById('log');
        let logCount = 0;
        
        function getTestUrl() {
            return document.getElementById('test-url').value.trim();
        }
        
        function addLog(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const statusClass = type;
            const statusIcon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
            
            logCount++;
            log.innerHTML += `<div class="${statusClass}">
                <span class="status-indicator ${statusClass}"></span>[${time}] ${statusIcon} ${message}
            </div>`;
            scrollToBottom();
        }
        
        function clearLog() {
            log.innerHTML = '';
            logCount = 0;
            addLog('ğŸ“‹ æ—¥å¿—å·²æ¸…ç©ºï¼Œå‡†å¤‡æ–°çš„æµ‹è¯•', 'info');
        }
        
        function scrollToBottom() {
            log.scrollTop = log.scrollHeight;
        }
        
        function exportLog() {
            const logContent = log.innerText;
            const blob = new Blob([logContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `debug_log_${new Date().toISOString().slice(0,19).replace(/:/g,'-')}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        async function testZjcdnApi() {
            const testUrl = getTestUrl();
            if (!testUrl) {
                addLog('è¯·å…ˆè¾“å…¥æµ‹è¯•URL', 'error');
                return;
            }
            
            addLog('ğŸš€ å¼€å§‹æµ‹è¯• zjcdn API...', 'info');
            addLog(`ğŸ“ æµ‹è¯•URL: ${testUrl}`, 'info');
            
            try {
                const response = await fetch('/zjcdn', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: testUrl })
                });
                
                addLog(`ğŸ“¡ APIå“åº”çŠ¶æ€: ${response.status}`, response.ok ? 'success' : 'error');
                
                if (!response.ok) {
                    addLog(`âŒ HTTPé”™è¯¯: ${response.status} ${response.statusText}`, 'error');
                    return;
                }
                
                const result = await response.json();
                
                if (result.code === 0) {
                    addLog('âœ… zjcdn APIè°ƒç”¨æˆåŠŸï¼', 'success');
                    addLog(`ğŸ“‹ è§£ææ–¹æ³•: ${result.data.method}`, 'info');
                    addLog(`ğŸ¬ è§†é¢‘é“¾æ¥æ•°é‡: ${result.data.video.length}`, 'success');
                    addLog(`ğŸ–¼ï¸ å›¾ç‰‡é“¾æ¥æ•°é‡: ${result.data.img.length}`, 'info');
                    addLog(`ğŸ“· æ˜¯å¦å›¾ç‰‡åˆ†äº«: ${result.data.isImagesShare}`, 'info');
                    
                    if (result.data.video.length > 0) {
                        addLog('ğŸ“¹ è§†é¢‘é“¾æ¥è¯¦æƒ…:', 'info');
                        result.data.video.forEach((url, index) => {
                            const isZjcdn = url.includes('zjcdn.com');
                            const urlPreview = url.length > 60 ? url.substring(0, 60) + '...' : url;
                            addLog(`   ${index + 1}. ${isZjcdn ? '[ZJCDNç›´é“¾]' : '[å…¶ä»–æ¥æº]'} ${urlPreview}`, isZjcdn ? 'success' : 'warning');
                        });
                    }
                    
                    if (result.data.img.length > 0) {
                        addLog(`ğŸ–¼ï¸ å‘ç°${result.data.img.length}å¼ å›¾ç‰‡`, 'info');
                    }
                    
                } else {
                    addLog(`âŒ zjcdn APIè¿”å›é”™è¯¯: ${result.msg}`, 'error');
                }
                
            } catch (error) {
                addLog(`âŒ zjcdn APIæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testGetRealUrl() {
            const testUrl = getTestUrl();
            if (!testUrl) {
                addLog('è¯·å…ˆè¾“å…¥æµ‹è¯•URL', 'error');
                return;
            }
            
            addLog('ğŸ” å¼€å§‹æµ‹è¯•URLè§£æåŠŸèƒ½...', 'info');
            
            try {
                const response = await fetch(`/get-real-url?url=${encodeURIComponent(testUrl)}`);
                const result = await response.json();
                
                if (result.success) {
                    addLog('âœ… URLè§£ææˆåŠŸï¼', 'success');
                    addLog(`ğŸŒ åŸå§‹URL: ${result.originalUrl.substring(0, 60)}...`, 'info');
                    addLog(`ğŸ¯ çœŸå®URL: ${result.realUrl.substring(0, 60)}...`, 'success');
                    
                    // æ˜¾ç¤ºURLç±»å‹
                    if (result.urlType) {
                        addLog(`ğŸ·ï¸ URLç±»å‹: ${result.urlType === 'douyin' ? 'æŠ–éŸ³é“¾æ¥' : 'æ™®é€šé“¾æ¥'}`, 'info');
                    }
                    
                    addLog(`ğŸ“‹ å†…å®¹ç±»å‹: ${result.headers.contentType}`, 'info');
                    addLog(`ğŸ“ æ–‡ä»¶å¤§å°: ${result.headers.contentLength}`, 'info');
                    addLog(`ğŸ”„ æ˜¯å¦é‡å®šå‘: ${result.redirected ? 'æ˜¯' : 'å¦'}`, result.redirected ? 'info' : 'info');
                    
                    // æ ¹æ®çŠ¶æ€ç ç»™å‡ºä¸åŒçš„æç¤º
                    if (result.status === 200) {
                        addLog(`ğŸ“Š å“åº”çŠ¶æ€: ${result.status} (æ­£å¸¸)`, 'success');
                    } else if (result.status === 404) {
                        addLog(`ğŸ“Š å“åº”çŠ¶æ€: ${result.status} (é¡µé¢ä¸å­˜åœ¨ - æŠ–éŸ³é“¾æ¥å¯èƒ½éœ€è¦zjcdn APIè§£æ)`, 'warning');
                    } else if (result.status >= 400) {
                        addLog(`ğŸ“Š å“åº”çŠ¶æ€: ${result.status} (å®¢æˆ·ç«¯/æœåŠ¡å™¨é”™è¯¯)`, 'warning');
                    } else if (result.status >= 300) {
                        addLog(`ğŸ“Š å“åº”çŠ¶æ€: ${result.status} (é‡å®šå‘)`, 'info');
                    } else {
                        addLog(`ğŸ“Š å“åº”çŠ¶æ€: ${result.status}`, 'info');
                    }
                    
                    if (result.headers.server !== 'unknown') {
                        addLog(`ğŸ–¥ï¸ æœåŠ¡å™¨: ${result.headers.server}`, 'info');
                    }
                    
                } else {
                    addLog(`âŒ URLè§£æå¤±è´¥: ${result.error}`, 'error');
                    if (result.originalUrl) {
                        addLog(`ğŸŒ å°è¯•è§£æçš„URL: ${result.originalUrl}`, 'info');
                    }
                }
            } catch (error) {
                addLog(`âŒ URLè§£æè¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testDirectDownload() {
            const testUrl = getTestUrl();
            if (!testUrl) {
                addLog('è¯·å…ˆè¾“å…¥æµ‹è¯•URL', 'error');
                return;
            }
            
            addLog('â¬‡ï¸ å¼€å§‹æµ‹è¯•æ™ºèƒ½ä¸‹è½½åŠŸèƒ½...', 'info');
            const filename = `debug_test_${Date.now()}.mp4`;
            
            try {
                const directUrl = `/direct-download?${new URLSearchParams({
                    url: testUrl,
                    filename: filename
                })}`;
                
                addLog(`ğŸ”— ä¸‹è½½URL: ${directUrl}`, 'info');
                
                const link = document.createElement('a');
                link.href = directUrl;
                link.download = filename;
                link.style.display = 'none';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                addLog('ğŸš€ æ™ºèƒ½ä¸‹è½½å·²è§¦å‘ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨ä¸‹è½½', 'success');
                addLog(`ğŸ“ æ–‡ä»¶å: ${filename}`, 'info');
                
            } catch (error) {
                addLog(`âŒ æ™ºèƒ½ä¸‹è½½å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testVideoId() {
            addLog('ğŸ¯ å¼€å§‹æµ‹è¯•VideoIDåŠŸèƒ½...', 'info');
            const testVideoId = '7536474232273964314'; // ä½¿ç”¨çœŸå®çš„æµ‹è¯•videoId
            
            try {
                const response = await fetch('/test-videoid', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ videoId: testVideoId })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    addLog('âœ… VideoIDæµ‹è¯•æˆåŠŸï¼', 'success');
                    addLog(`ğŸ¯ VideoId: ${result.videoId}`, 'info');
                    addLog(`ğŸ“ æ ‡é¢˜: ${result.title || 'æ— æ ‡é¢˜'}`, 'info');
                    addLog(`ğŸ‘¤ ä½œè€…: ${result.author || 'æœªçŸ¥'}`, 'info');
                    addLog(`ğŸ“± åª’ä½“ç±»å‹: ${result.mediaType}`, 'info');
                    addLog(`ğŸ¬ åŒ…å«è§†é¢‘: ${result.hasVideo ? 'æ˜¯' : 'å¦'}`, result.hasVideo ? 'success' : 'warning');
                    addLog(`ğŸ–¼ï¸ åŒ…å«å›¾ç‰‡: ${result.hasImages ? 'æ˜¯' : 'å¦'}`, result.hasImages ? 'info' : 'info');
                } else {
                    addLog(`âŒ VideoIDæµ‹è¯•å¤±è´¥: ${result.error}`, 'error');
                }
                
            } catch (error) {
                addLog(`âŒ VideoIDæµ‹è¯•å‡ºé”™: ${error.message}`, 'error');
            }
        }
        
        async function testProxyDownload() {
            const testUrl = getTestUrl();
            if (!testUrl) {
                addLog('è¯·å…ˆè¾“å…¥æµ‹è¯•URL', 'error');
                return;
            }
            
            addLog('ğŸŒ å¼€å§‹æµ‹è¯•ä»£ç†ä¸‹è½½åŠŸèƒ½...', 'info');
            
            try {
                // é¦–å…ˆè·å–zjcdné“¾æ¥
                const zjcdnResponse = await fetch('/zjcdn', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: testUrl })
                });
                
                const zjcdnResult = await zjcdnResponse.json();
                
                if (zjcdnResult.code !== 0 || zjcdnResult.data.video.length === 0) {
                    addLog('âŒ æ— æ³•è·å–æœ‰æ•ˆçš„è§†é¢‘é“¾æ¥', 'error');
                    return;
                }
                
                const videoUrl = zjcdnResult.data.video[0];
                const filename = `proxy_test_${Date.now()}.mp4`;
                
                const proxyUrl = `/proxy-download?url=${encodeURIComponent(videoUrl)}&filename=${filename}`;
                
                addLog('ğŸš€ å¼€å§‹ä»£ç†ä¸‹è½½...', 'info');
                addLog(`ğŸ¯ è§†é¢‘æº: ${videoUrl.substring(0, 60)}...`, 'info');
                
                const link = document.createElement('a');
                link.href = proxyUrl;
                link.download = filename;
                link.style.display = 'none';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                addLog('âœ… ä»£ç†ä¸‹è½½å·²è§¦å‘ï¼', 'success');
                addLog(`ğŸ“ æ–‡ä»¶å: ${filename}`, 'info');
                
            } catch (error) {
                addLog(`âŒ ä»£ç†ä¸‹è½½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testVideoProxy() {
            const testUrl = getTestUrl();
            if (!testUrl) {
                addLog('è¯·å…ˆè¾“å…¥æµ‹è¯•URL', 'error');
                return;
            }
            
            addLog('ğŸ¬ å¼€å§‹æµ‹è¯•è§†é¢‘é¢„è§ˆä»£ç†...', 'info');
            
            try {
                // è·å–è§†é¢‘é“¾æ¥
                const zjcdnResponse = await fetch('/zjcdn', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: testUrl })
                });
                
                const zjcdnResult = await zjcdnResponse.json();
                
                if (zjcdnResult.code !== 0 || zjcdnResult.data.video.length === 0) {
                    addLog('âŒ æ— æ³•è·å–æœ‰æ•ˆçš„è§†é¢‘é“¾æ¥', 'error');
                    return;
                }
                
                const videoUrl = zjcdnResult.data.video[0];
                const proxyUrl = `/proxy-video?url=${encodeURIComponent(videoUrl)}`;
                
                addLog('ğŸ¯ æµ‹è¯•è§†é¢‘é¢„è§ˆä»£ç†...', 'info');
                addLog(`ğŸ“º ä»£ç†URL: ${proxyUrl}`, 'info');
                
                // åˆ›å»ºè§†é¢‘å…ƒç´ æµ‹è¯•
                const video = document.createElement('video');
                video.src = proxyUrl;
                video.controls = true;
                video.style.cssText = `
                    width: 100%;
                    max-width: 500px;
                    max-height: 400px;
                    border-radius: 8px;
                    background: #000;
                `;
                
                video.addEventListener('loadstart', () => {
                    addLog('ğŸ”„ è§†é¢‘å¼€å§‹åŠ è½½...', 'info');
                });
                
                video.addEventListener('canplay', () => {
                    addLog('âœ… è§†é¢‘é¢„è§ˆä»£ç†å·¥ä½œæ­£å¸¸ï¼', 'success');
                    addLog('ğŸ¬ è§†é¢‘å¯ä»¥æ­£å¸¸æ’­æ”¾', 'success');
                });
                
                video.addEventListener('error', (e) => {
                    addLog(`âŒ è§†é¢‘é¢„è§ˆå¤±è´¥: ${e.message}`, 'error');
                });
                
                // åˆ›å»ºèƒŒæ™¯é®ç½©
                const overlay = document.createElement('div');
                overlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: rgba(0,0,0,0.5);
                    z-index: 999;
                `;
                overlay.onclick = () => {
                    overlay.remove();
                    testContainer.remove();
                    addLog('ğŸ§¹ è§†é¢‘é¢„è§ˆå·²å…³é—­', 'info');
                };
                
                // åˆ›å»ºå›ºå®šä½ç½®çš„è§†é¢‘é¢„è§ˆå®¹å™¨
                const testContainer = document.createElement('div');
                testContainer.id = 'video-preview-container';
                testContainer.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: white;
                    border: 2px solid #74b9ff;
                    border-radius: 12px;
                    padding: 20px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    z-index: 1000;
                    max-width: 90vw;
                    max-height: 80vh;
                    overflow: auto;
                `;
                
                const closeBtn = document.createElement('button');
                closeBtn.innerHTML = 'âŒ å…³é—­é¢„è§ˆ';
                closeBtn.style.cssText = `
                    position: absolute;
                    top: 10px;
                    right: 10px;
                    background: #e17055;
                    color: white;
                    border: none;
                    padding: 8px 12px;
                    border-radius: 5px;
                    cursor: pointer;
                    font-size: 12px;
                `;
                closeBtn.onclick = () => {
                    overlay.remove();
                    testContainer.remove();
                    addLog('ğŸ§¹ è§†é¢‘é¢„è§ˆå·²å…³é—­', 'info');
                };
                
                const title = document.createElement('h3');
                title.innerHTML = 'ğŸ¬ è§†é¢‘é¢„è§ˆæµ‹è¯•';
                title.style.cssText = 'margin-top: 30px; margin-bottom: 15px; color: #2c3e50;';
                
                testContainer.appendChild(closeBtn);
                testContainer.appendChild(title);
                testContainer.appendChild(video);
                
                document.body.appendChild(overlay);
                document.body.appendChild(testContainer);
                
                // 15ç§’åè‡ªåŠ¨ç§»é™¤æµ‹è¯•è§†é¢‘
                setTimeout(() => {
                    if (testContainer.parentNode) {
                        overlay.remove();
                        testContainer.remove();
                        addLog('ğŸ§¹ æµ‹è¯•è§†é¢‘å·²è‡ªåŠ¨æ¸…ç†', 'info');
                    }
                }, 15000);
                
            } catch (error) {
                addLog(`âŒ è§†é¢‘é¢„è§ˆä»£ç†æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testServerHealth() {
            addLog('â¤ï¸ å¼€å§‹æœåŠ¡å™¨å¥åº·æ£€æŸ¥...', 'info');
            
            const healthTests = [
                { name: 'ä¸»é¡µè®¿é—®', url: '/', method: 'GET' },
                { name: 'zjcdnæ¥å£', url: '/zjcdn', method: 'POST', body: { url: 'https://v.douyin.com/test/' } },
                { name: 'æµ‹è¯•ç«¯ç‚¹æ£€æŸ¥', url: '/get-real-url?url=' + encodeURIComponent('https://httpbin.org/status/200'), method: 'GET' }
            ];
            
            addLog('ğŸ” æ‰§è¡ŒåŸºç¡€æ¥å£æ£€æŸ¥...', 'info');
            
            for (const test of healthTests) {
                try {
                    const options = {
                        method: test.method,
                        headers: test.body ? { 'Content-Type': 'application/json' } : {}
                    };
                    
                    if (test.body) {
                        options.body = JSON.stringify(test.body);
                    }
                    
                    const startTime = Date.now();
                    const response = await fetch(test.url, options);
                    const responseTime = Date.now() - startTime;
                    
                    if (response.ok) {
                        addLog(`âœ… ${test.name}: HTTP ${response.status} (${responseTime}ms)`, 'success');
                    } else {
                        addLog(`âš ï¸ ${test.name}: HTTP ${response.status} (${responseTime}ms)`, 'warning');
                    }
                    
                } catch (error) {
                    addLog(`âŒ ${test.name}: ${error.message}`, 'error');
                }
            }
            
            // å•ç‹¬æµ‹è¯•ä»£ç†åŠŸèƒ½ï¼ˆä»…æ£€æŸ¥æ¥å£å“åº”ï¼Œä¸å®é™…ä¸‹è½½ï¼‰
            addLog('ğŸŒ æ£€æŸ¥ä»£ç†æ¥å£çŠ¶æ€...', 'info');
            
            try {
                // æµ‹è¯•ä»£ç†ä¸‹è½½æ¥å£æ˜¯å¦å“åº”ï¼ˆä½¿ç”¨HEADæ–¹æ³•é¿å…å®é™…ä¸‹è½½ï¼‰
                const proxyResponse = await fetch('/proxy-download?url=' + encodeURIComponent('https://httpbin.org/status/204'), {
                    method: 'HEAD'
                });
                
                if (proxyResponse.status === 405) {
                    // HEADæ–¹æ³•ä¸æ”¯æŒæ˜¯æ­£å¸¸çš„ï¼Œè¯´æ˜æ¥å£å­˜åœ¨
                    addLog('âœ… ä»£ç†ä¸‹è½½æ¥å£: æ¥å£å¯ç”¨ (HEADæ–¹æ³•é™åˆ¶æ˜¯æ­£å¸¸çš„)', 'success');
                } else if (proxyResponse.ok) {
                    addLog('âœ… ä»£ç†ä¸‹è½½æ¥å£: å“åº”æ­£å¸¸', 'success');
                } else {
                    addLog(`âš ï¸ ä»£ç†ä¸‹è½½æ¥å£: HTTP ${proxyResponse.status}`, 'warning');
                }
                
            } catch (error) {
                addLog(`âŒ ä»£ç†ä¸‹è½½æ¥å£: ${error.message}`, 'error');
            }
            
            try {
                // æµ‹è¯•è§†é¢‘ä»£ç†æ¥å£
                const videoProxyResponse = await fetch('/proxy-video?url=' + encodeURIComponent('https://httpbin.org/status/204'), {
                    method: 'HEAD'
                });
                
                if (videoProxyResponse.status === 405) {
                    addLog('âœ… è§†é¢‘ä»£ç†æ¥å£: æ¥å£å¯ç”¨ (HEADæ–¹æ³•é™åˆ¶æ˜¯æ­£å¸¸çš„)', 'success');
                } else if (videoProxyResponse.ok) {
                    addLog('âœ… è§†é¢‘ä»£ç†æ¥å£: å“åº”æ­£å¸¸', 'success');
                } else {
                    addLog(`âš ï¸ è§†é¢‘ä»£ç†æ¥å£: HTTP ${videoProxyResponse.status}`, 'warning');
                }
                
            } catch (error) {
                addLog(`âŒ è§†é¢‘ä»£ç†æ¥å£: ${error.message}`, 'error');
            }
            
            addLog('â¤ï¸ æœåŠ¡å™¨å¥åº·æ£€æŸ¥å®Œæˆï¼', 'success');
        }
        
        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addLog('ğŸš€ æŠ–éŸ³ä¸‹è½½è°ƒè¯•æ§åˆ¶å°å·²åŠ è½½', 'success');
            addLog('ğŸ’¡ è¯·è¾“å…¥æµ‹è¯•URLå¹¶é€‰æ‹©ç›¸åº”çš„æµ‹è¯•åŠŸèƒ½', 'info');
            addLog('ğŸ”§ å»ºè®®å…ˆè¿›è¡ŒæœåŠ¡å™¨å¥åº·æ£€æŸ¥', 'info');
        });
    </script>
</body>
</html>
