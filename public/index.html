<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>抖音工具</title>

    <!-- Bootstrap CSS -->
    <link href="./bootstrap.min.css" rel="stylesheet" />
    
    <!-- Custom CSS -->
    <link href="./main.css" rel="stylesheet" />
  </head>
  <body>
    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="theme-toggle" aria-label="切换主题">
      🌙
    </button>
    
    <!-- Simple Cookie Status Button -->
    <button class="cookie-status-btn" id="cookie-status-btn" title="Cookie状态 - 点击管理">
      <span class="cookie-icon">🍪</span>
    </button>
    
    <div class="container mt-3">
      <div class="row justify-content-center">
        <div class="col-12 col-md-8 col-lg-6">
          <h1 class="mb-3 fs-1 text-center fst-italic">抖音工具</h1>
          <form id="downloadForm" class="d-flex flex-column">
            <div class="form-group mb-3">
              <textarea
                class="form-control"
                id="videoUrl"
                style="resize: none; transition: height 0.2s ease;"
                placeholder="粘贴抖音分享地址（只能粘贴一条）

提示：如果出现&quot;链接已过期&quot;，请：
1. 使用新的抖音分享链接
2. 确保链接完整（包含 https://）
3. 尝试从抖音APP重新分享"
                autocomplete="off"
                autocorrect="off"
                autocapitalize="off"
                spellcheck="false"
              ></textarea>
            </div>
            <button type="submit" id="submit" class="btn btn-primary btn-lg">
              <span
                id="loading"
                class="spinner-border spinner-border-sm me-2"
                hidden
                aria-hidden="true"
              ></span>
              <span id="submit-text">解析</span>
            </button>
          </form>
        </div>
      </div>
      
      <!-- Media Preview Section - Desktop: Same width as form, Mobile: Full width when focused -->
      <div class="row justify-content-center">
        <div class="col-12" id="mediaPreviewColumn">
          <div id="mediaPreview" class="mt-4" hidden>
            <div class="d-flex align-items-center justify-content-center mb-3" style="gap: 12px;">
              <h5 class="mb-0 flex-shrink-0">📱 内容预览</h5>
              <div class="d-flex align-items-center" style="gap: 5px;">
                <!-- 一键下载按钮 - 仅在文件数量达到10个或以上时显示 -->
                <button type="button" class="btn btn-sm btn-success flex-shrink-0" id="batchDownloadBtn" style="display: none;" onclick="downloadAllMedia()">
                  <span class="download-progress-indicator"></span>
                  📥 一键下载
                </button>
                <div class="btn-group flex-shrink-0" role="group">
                  <button type="button" class="btn btn-sm btn-outline-primary" onclick="toggleView('list')">
                    📋 列表
                  </button>
                  <button type="button" class="btn btn-sm btn-outline-primary" onclick="toggleView('grid')">
                    🔲 网格
                  </button>
                </div>
              </div>
            </div>
            <div id="mediaContainer" class="media-container">
              <!-- 动态内容将在这里显示 -->
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 下载进度条 -->
    <div id="download-progress-bar">
      <div class="progress-content">
        <div class="progress-info">
          <span class="progress-text">📥 批量下载中...</span>
          <span class="progress-stats">
            <span id="progress-current">0</span>/<span id="progress-total">0</span>
          </span>
        </div>
        <div class="progress-bar-wrapper">
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
          </div>
        </div>
        <button class="progress-close" onclick="hideDownloadProgress()" title="隐藏进度条">
          ✕
        </button>
      </div>
    </div>
    
    <!-- Lightbox Modal -->
    <div id="lightbox" class="lightbox">
      <span class="lightbox-close">&times;</span>
      <span class="lightbox-nav lightbox-prev">❮</span>
      <span class="lightbox-nav lightbox-next">❯</span>
      <div class="lightbox-content">
        <img id="lightbox-img" src="" alt="">
      </div>
    </div>
    
    <!-- Cookie Update Modal -->
    <div id="cookieModal" class="cookie-modal" style="display: none;">
      <div class="cookie-modal-dialog">
        <div class="cookie-modal-header">
          <h3 class="cookie-modal-title">🍪 Cookie管理</h3>
          <button type="button" class="cookie-modal-close" aria-label="关闭">&times;</button>
        </div>
        
        <!-- Cookie Status Info -->
        <div class="cookie-status-info" id="cookie-status-info">
          <div class="status-row">
            <span class="status-label">当前状态:</span>
            <span class="status-value" id="modal-status-text">检查中...</span>
            <span class="status-icon" id="modal-status-icon">⏳</span>
          </div>
          <div class="status-row">
            <span class="status-label">来源:</span>
            <span class="status-value" id="modal-cookie-source">-</span>
          </div>
          <div class="status-row">
            <span class="status-label">剩余时间:</span>
            <span class="status-value" id="modal-cookie-remaining">-</span>
          </div>
          <div class="status-row">
            <span class="status-label">有效性:</span>
            <span class="status-value" id="modal-cookie-validity">-</span>
          </div>
        </div>
        
        <div class="cookie-modal-body">
          <p class="text-muted mb-3">
            当出现"Cookie已失效"错误时，需要更新Cookie。您可以输入完整的cookie或只输入sid_guard的值。
          </p>
          
          <div class="mb-3">
            <label for="cookie-textarea" class="form-label">Cookie值:</label>
            <textarea
              id="cookie-textarea"
              class="cookie-textarea"
              rows="4"
              placeholder="可以输入以下任一格式：

1. 完整cookie：sid_guard=xxxxxx...;
2. 只输入sid_guard值：xxxxxx%7Cxxxxxxxx%7Cxxxxxxx%7CDate

系统会自动识别并处理"
            ></textarea>
            <div class="form-text">
              <small>
                <strong>获取方法：</strong><br>
                1. 打开浏览器访问 douyin.com<br>
                2. 按F12打开开发者工具<br>
                3. 在Network标签页刷新页面<br>
                4. 找到任意请求，复制Request Headers中的Cookie值或sid_guard部分
              </small>
            </div>
            
            <!-- Vercel环境变量更新选项 -->
            <div class="vercel-options mt-3">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="update-vercel-env" />
                <label class="form-check-label" for="update-vercel-env">
                  同时更新Vercel环境变量 <span class="text-muted">(需要配置)</span>
                </label>
              </div>
              <div id="vercel-config-status" class="vercel-config-status mt-2"></div>
            </div>
          </div>
          
          <div id="cookie-status" class="cookie-status"></div>
        </div>
        <div class="cookie-modal-footer">
          <button type="button" class="cookie-btn cookie-btn-secondary" id="cookie-cancel-btn">取消</button>
          <button type="button" class="cookie-btn cookie-btn-primary" id="cookie-save-btn">
            更新Cookie
          </button>
        </div>
      </div>
    </div>
    
    <!-- JavaScript -->
    <script src="./script.js"></script>
  </body>
</html>