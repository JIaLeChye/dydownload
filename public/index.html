<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>æŠ–éŸ³å·¥å…·</title>

    <!-- Bootstrap CSS -->
    <link href="./bootstrap.min.css" rel="stylesheet" />
    
    <!-- Mobile optimization styles -->
    <style>
      /* Mobile-first responsive design */
      @media (max-width: 768px) {
        .container {
          padding-left: 15px;
          padding-right: 15px;
        }
        
        h1 {
          font-size: 1.8rem !important;
          text-align: center;
          margin-bottom: 1.5rem;
        }
        
        .form-control {
          font-size: 16px; /* Prevents zoom on iOS */
          padding: 12px;
        }
        
        #videoUrl {
          min-height: 5rem !important;
        }
        
        #result {
          min-height: 6rem !important;
          font-size: 14px;
        }
        
        .btn {
          width: 100%;
          padding: 12px;
          font-size: 16px;
          margin-bottom: 10px;
        }
        
        .btn-primary {
          background-color: #007bff;
          border-color: #007bff;
        }
        
        /* Touch-friendly spacing */
        .mb-3 {
          margin-bottom: 1.5rem !important;
        }
        
        .mt-3 {
          margin-top: 1.5rem !important;
        }
        
        .mt-4 {
          margin-top: 2rem !important;
        }
      }
      
      /* Small mobile devices */
      @media (max-width: 480px) {
        .container {
          padding-left: 10px;
          padding-right: 10px;
        }
        
        h1 {
          font-size: 1.5rem !important;
          line-height: 1.3;
        }
        
        #videoUrl {
          min-height: 4rem !important;
        }
        
        #result {
          min-height: 5rem !important;
        }
        
        .btn {
          padding: 14px 12px;
        }
      }
      
      /* Prevent horizontal scrolling */
      body {
        overflow-x: hidden;
      }
      
      /* Better touch targets */
      .btn, .form-control {
        border-radius: 8px;
      }
      
      /* Loading spinner optimization for mobile */
      @media (max-width: 768px) {
        .spinner-border-sm {
          width: 1rem;
          height: 1rem;
        }
      }
      
      /* Copy button success state */
      .btn-success {
        background-color: #28a745;
        border-color: #28a745;
      }
      
      /* Smooth animations */
      .btn {
        transition: all 0.2s ease-in-out;
      }
      
      /* Better focus states for accessibility */
      .form-control:focus {
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        border-color: #007bff;
      }
      
      .btn:focus {
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.5);
      }
      
      /* Landscape mobile optimization */
      @media (max-width: 768px) and (orientation: landscape) {
        h1 {
          font-size: 1.4rem !important;
          margin-bottom: 1rem !important;
        }
        
        #videoUrl {
          min-height: 3rem !important;
        }
        
        #result {
          min-height: 4rem !important;
        }
      }
    </style>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        document
          .getElementById("submit")
          .addEventListener("click", function (e) {
            e.preventDefault();

            var videoUrl = document.getElementById("videoUrl").value;
            if (!videoUrl) {
              alert("è¯·è¾“å…¥è§†é¢‘é“¾æ¥ã€‚");
              return;
            }

            const requestData = { url: videoUrl };
            const resultDom = document.getElementById("result");
            const loadingDom = document.getElementById("loading");
            const copyDom = document.getElementById("autocopy");
            const submitText = document.getElementById("submit-text");
            
            // Show loading state
            if (loadingDom) loadingDom.hidden = false;
            if (copyDom) copyDom.hidden = true;
            if (resultDom) resultDom.hidden = true;
            if (submitText) submitText.textContent = "è§£æä¸­...";
            
            fetch("/workflow", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(requestData),
            })
              .then((response) => response.json())
              .then((data) => {
                if (resultDom) resultDom.hidden = false;
                if (loadingDom) loadingDom.hidden = true;
                if (copyDom) copyDom.hidden = false;
                if (submitText) submitText.textContent = "è§£æ";
                
                if (data.code === 0 && data.data.length > 0) {
                  resultDom.value = data.data.join(",\n");
                  // ç§»åŠ¨ç«¯å‹å¥½çš„åé¦ˆ
                  if (window.innerWidth <= 768) {
                    resultDom.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  }
                } else {
                  alert("è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥é“¾æ¥æ˜¯å¦æ­£ç¡®");
                }
              })
              .catch((error) => {
                console.error("There was an error!", error);
                if (loadingDom) loadingDom.hidden = true;
                if (submitText) submitText.textContent = "è§£æ";
                alert("ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•");
              });
          });
      });
      function copyTextToClipboard(textToCopy) {
        return new Promise((resolve, rejcet) => {
          const tempInput = document.createElement('input');
          tempInput.style.position = 'absolute';
          tempInput.style.left = '-9999px';
          tempInput.value = textToCopy;
          document.body.appendChild(tempInput);
          tempInput.select();
          try {
            const successful = document.execCommand('copy');
            const msg = successful ? 'æˆåŠŸ' : 'å¤±è´¥';
            resolve(msg)
          } catch (err) {
            rejcet(err)
          }
          document.body.removeChild(tempInput);
        })
  }
      function copyToClipboard() {
        var resultDom = document.getElementById("result");
        var textToCopy = resultDom.value;
        
        // ä¼˜å…ˆä½¿ç”¨ç°ä»£ clipboard API
        if (navigator.clipboard && window.isSecureContext) {
          navigator.clipboard.writeText(textToCopy)
            .then(function () {
              // ç§»åŠ¨ç«¯å‹å¥½çš„æˆåŠŸåé¦ˆ
              const copyButton = document.getElementById("autocopy");
              const originalText = copyButton.textContent;
              copyButton.textContent = "âœ… å¤åˆ¶æˆåŠŸ";
              copyButton.classList.add("btn-success");
              copyButton.classList.remove("btn-primary");
              
              setTimeout(() => {
                copyButton.textContent = originalText;
                copyButton.classList.add("btn-primary");
                copyButton.classList.remove("btn-success");
              }, 2000);
            })
            .catch(function (error) {
              fallbackCopyTextToClipboard(textToCopy);
            });
        } else {
          fallbackCopyTextToClipboard(textToCopy);
        }
      }

      function fallbackCopyTextToClipboard(text) {
        copyTextToClipboard(text).then(function () {
          alert('å¤åˆ¶æˆåŠŸï¼å¯ä»¥åœ¨æµè§ˆå™¨æˆ–å…¶ä»–åº”ç”¨ä¸­ç²˜è´´ä¸‹è½½é“¾æ¥')
        })
        .catch(function (error) {
          alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬å¤åˆ¶')
        });
      }
    </script>
  </head>
  <body>
    <div class="container mt-3">
      <div class="row justify-content-center">
        <div class="col-12 col-md-8 col-lg-6">
          <h1 class="mb-3 fs-1 text-center fst-italic">æŠ–éŸ³å·¥å…·</h1>
          <form id="downloadForm" class="d-flex flex-column">
            <div class="form-group mb-3">
              <textarea
                class="form-control"
                id="videoUrl"
                style="min-height: 6rem; resize: vertical;"
                placeholder="ç²˜è´´æŠ–éŸ³åˆ†äº«åœ°å€ï¼ˆåªèƒ½ç²˜è´´ä¸€æ¡ï¼‰"
                autocomplete="off"
                autocorrect="off"
                autocapitalize="off"
                spellcheck="false"
              ></textarea>
            </div>
            <button type="submit" id="submit" class="btn btn-primary btn-lg">
              <span
                id="loading"
                class="spinner-border spinner-border-sm me-2"
                hidden
                aria-hidden="true"
              ></span>
              <span id="submit-text">è§£æ</span>
            </button>
          </form>
          <textarea
            class="form-control mt-4"
            id="result"
            placeholder="è§£æåçš„ä¸‹è½½åœ°å€"
            readonly
            hidden
            style="min-height: 8rem; resize: vertical;"
          ></textarea>
          <button
            onclick="copyToClipboard()"
            id="autocopy"
            class="btn btn-primary btn-lg mt-3"
            data-clipboard-target="#result"
            hidden
          >
            ğŸ“‹ ä¸€é”®å¤åˆ¶
          </button>
        </div>
      </div>
    </div>
    <!-- <a href="/readme" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style> -->
  </body>
</html>
